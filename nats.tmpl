listen: ":{{ .Port }}"

jetstream: enabled

jetstream {
    store_dir: "{{ .JetstreamStore }}"
    max_mem: 1G
    max_file: 5G
}

tls {
  cert_file:  "{{ .NATSCertPath }}"
  key_file:   "{{ .NATSKeyPath }}"
  ca_file:   "{{ .NATSCAPath }}"
  verify_and_map: true
  ocsp_peer: true
}

authorization: {  
  users = [
    {user: "CN=OpenUEM Cert-Manager Worker,OU=worker,O={{ .Org }},POSTALCODE={{ .PostalCode }},STREET={{ .Street }},L={{ .Locality }},ST={{ .Province }},C={{ .Country }},", permissions: {
      sub: {
        allow: ["_INBOX.>", "certificates.>", "ping.certmanagerworker openuem-cert-manager", "$JS.API.STREAM.CREATE.>", "$JS.API.STREAM.UPDATE.>", "$JS.API.CONSUMER.CREATE.>", "$JS.API.CONSUMER.MSG.NEXT.>", "$JS.ACK.>", "$JS.NACK.>"]
      }
    }},
    {user: "CN=OpenUEM Notification Worker,OU=worker,O={{ .Org }},POSTALCODE={{ .PostalCode }},STREET={{ .Street }},L={{ .Locality }},ST={{ .Province }},C={{ .Country }},", permissions: {
      sub: {
        allow: ["_INBOX.>", "notification.>", "ping.notificationworker openuem-notification", "$JS.API.STREAM.CREATE.>", "$JS.API.STREAM.UPDATE.>", "$JS.API.CONSUMER.CREATE.>", "$JS.API.CONSUMER.MSG.NEXT.>", "$JS.ACK.>", "$JS.NACK.>"]
      }
    }},
    {user: "CN=OpenUEM Console,O={{ .Org }},POSTALCODE={{ .PostalCode }},STREET={{ .Street }},L={{ .Locality }},ST={{ .Province }},C={{ .Country }},", permissions: {
      publish: ["agent.>", "agentupdate.>", "agentrollback.>", "notification.>", "certificates.>", "ping.>", "nats.update.>", "nats.rollback.>", "ocsp.update.>", "ocsp.rollback.>", "agent-worker.update.>", "agent-worker.rollback.>", "notification-worker.update.>", "notification-worker.rollback.>", "cert-manager-worker.update.>", "cert-manager-worker.rollback.>", "console.update.>", "console.rollback.>"]
    }},
    {user: "CN=OpenUEM Updater Client,OU=updater,O={{ .Org }},POSTALCODE={{ .PostalCode }},STREET={{ .Street }},L={{ .Locality }},ST={{ .Province }},C={{ .Country }},", permissions: { 
      sub: {
        allow: ["agentupdate.>", "agentrollback.>", "agent.update.messenger", "agent.rollback.messenger", "nats.update.>", "nats.rollback.>", "ocsp.update.>", "ocsp.rollback.>", "agent-worker.update.>", "agent-worker.rollback.>", "notification-worker.update.>", "notification-worker.rollback.>", "cert-manager-worker.update.>", "cert-manager-worker.rollback.>", "console.update.>", "console.rollback.>"]
      }
    }},
    {user: "CN=OpenUEM Agent Worker,OU=worker,O={{ .Org }},POSTALCODE={{ .PostalCode }},STREET={{ .Street }},L={{ .Locality }},ST={{ .Province }},C={{ .Country }},", permissions: { 
      sub: {
        allow: ["report openuem-agents", "deployresult openuem-agents", "ping.agentworker openuem-agents", "agentconfig openuem-agents"]
      }
    }},
    {user: "CN=OpenUEM Agent,OU=agent,O={{ .Org }},POSTALCODE={{ .PostalCode }},STREET={{ .Street }},L={{ .Locality }},ST={{ .Province }},C={{ .Country }},", permissions: {
      sub: {
        allow: ["_INBOX.>", "agent.certificate", "agent.newconfig", "agent.installpackage.>", "agent.uninstallpackage.>", "agent.updatepackage.>", "agent.enable.>", "agent.disable.>", "agent.report.>", "agent.update.updater", "agent.rollback.updater", "agent.startvnc.> openuem-agent-management", "agent.stopvnc.> openuem-agent-management", "agent.restart.> openuem-agent-management"]
      },
      publish: ["report", "_INBOX.>", "deployresult", "agentconfig", "$JS.API.STREAM.CREATE.>", "$JS.API.STREAM.UPDATE.>", "$JS.API.CONSUMER.CREATE.>", "$JS.API.CONSUMER.MSG.NEXT.>", "$JS.ACK.>", "$JS.NACK.>"]
    }},
  ]
}
